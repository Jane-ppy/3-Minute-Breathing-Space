<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三分鐘呼吸空間 - 反思問卷</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo">
                    <h1>三分鐘呼吸空間</h1>
                </a>
                <ul>
                    <li><a href="project-origin.html">專題起源</a></li>
                    <li><a href="meditation-benefits.html">冥想好處</a></li>
                    <li><a href="meditation-records.html">冥想紀錄</a></li>
                    <li><a href="about-us.html">關於我們</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main">
        <section class="reflection-section">
            <h1>歡迎來到三分鐘呼吸空間</h1>
            <p class="subtitle">讓我們一起開始這段平靜的旅程</p>

            <form id="reflectionForm" class="reflection-form">
                <div class="pre-meditation">
                    <p class="section-title">在冥想前，請花些時間反思以下問題：</p>
                    
                    <div class="question-group">
                        <div class="question">
                            <h4>請輸入您「平均每天」的手機使用時間（小時）</h4>
                            <div class="input-container">
                                <input type="number" id="screen-time" name="screenTime" class="time-input" min="0" max="24" step="0.5" placeholder="請輸入 0-24 之間的數字">
                                <span class="unit">小時</span>
                            </div>
                        </div>

                        <div class="question">
                            <h4>這個數字比您預期的多還是少？</h4>
                            <div class="options">
                                <label class="option">
                                    <input type="radio" name="screenTimeCompare" value="比預期多">
                                    <span>比預期多</span>
                                </label>
                                <label class="option">
                                    <input type="radio" name="screenTimeCompare" value="比預期少">
                                    <span>比預期少</span>
                                </label>
                                <label class="option">
                                    <input type="radio" name="screenTimeCompare" value="跟預期差不多">
                                    <span>跟預期差不多</span>
                                </label>
                            </div>
                        </div>

                        <div class="question">
                            <h4>日常休息時，您通常會做什麼？</h4>
                            <div class="options">
                                <label class="option">
                                    <input type="checkbox" name="restActivity" value="滑手機">
                                    <span>滑手機</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="restActivity" value="小睡">
                                    <span>小睡</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="restActivity" value="看劇/聽音樂">
                                    <span>看劇/聽音樂</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="restActivity" value="散步/運動">
                                    <span>散步/運動</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="restActivity" value="other">
                                    <span>其他</span>
                                    <div class="other-option">
                                        <input type="text" name="restActivityOther" placeholder="請填寫">
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="question">
                            <h4>您平常在街上或搭車時會怎麼打發時間？</h4>
                            <div class="options">
                                <label class="option">
                                    <input type="checkbox" name="commutingActivity" value="看手機/聽音樂">
                                    <span>看手機/聽音樂</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="commutingActivity" value="發呆">
                                    <span>發呆</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="commutingActivity" value="觀察路人">
                                    <span>觀察路人</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="commutingActivity" value="想事情">
                                    <span>想事情</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="commutingActivity" value="other">
                                    <span>其他</span>
                                    <div class="other-option">
                                        <input type="text" name="commutingActivityOther" placeholder="請填寫">
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="question">
                            <h4>與親友聚會時，您會不自覺查看手機嗎？</h4>
                            <div class="options">
                                <label class="option">
                                    <input type="radio" name="socialPhone" value="會，而且蠻頻繁的">
                                    <span>會，而且蠻頻繁的</span>
                                </label>
                                <label class="option">
                                    <input type="radio" name="socialPhone" value="偶爾會">
                                    <span>偶爾會</span>
                                </label>
                                <label class="option">
                                    <input type="radio" name="socialPhone" value="幾乎不會">
                                    <span>幾乎不會</span>
                                </label>
                                <label class="option">
                                    <input type="radio" name="socialPhone" value="完全不會">
                                    <span>完全不會</span>
                                </label>
                                <label class="option">
                                    <input type="radio" name="socialPhone" value="other">
                                    <span>其他</span>
                                    <div class="other-option">
                                        <input type="text" name="socialPhoneOther" placeholder="請填寫">
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="meditation-audio">
                    <h3>三分鐘街頭冥想</h3>
                    <p class="audio-guide">請找一個安靜的地方，開始今天的街頭冥想練習</p>
                    <div class="audio-player">
                        <audio controls preload="auto">
                            <source src="assets/audio/三分鐘呼吸空間.mp3" type="audio/mpeg">
                            <source src="assets/audio/三分鐘呼吸空間.ogg" type="audio/ogg">
                            您的瀏覽器不支援音訊播放，請嘗試使用其他瀏覽器
                        </audio>
                    </div>
                </div>

                <div class="post-meditation">
                    <p class="section-title">冥想後，請花些分鐘回顧您的感受與觀察：</p>
                    
                    <div class="question-group">
                        <div class="question">
                            <h4>剛才的三分鐘體驗比您想像中如何？請選出三個形容詞：</h4>
                            <div class="options">
                                <label class="option">
                                    <input type="checkbox" name="meditationExperience" value="平靜">
                                    <span>平靜</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="meditationExperience" value="雜亂">
                                    <span>雜亂</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="meditationExperience" value="安心">
                                    <span>安心</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="meditationExperience" value="分心">
                                    <span>分心</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="meditationExperience" value="專注">
                                    <span>專注</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="meditationExperience" value="焦慮">
                                    <span>焦慮</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="meditationExperience" value="other">
                                    <span>其他</span>
                                    <div class="other-option">
                                        <input type="text" name="meditationExperienceOther" placeholder="請填寫">
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="question">
                            <h4>您的思緒有飄走嗎？如果有，是關於什麼？</h4>
                            <div class="options">
                                <label class="option">
                                    <input type="checkbox" name="thoughtDrift" value="工作/壓力">
                                    <span>工作/壓力</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="thoughtDrift" value="家人/關係">
                                    <span>家人/關係</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="thoughtDrift" value="健康/身體">
                                    <span>健康/身體</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="thoughtDrift" value="今天要做的事">
                                    <span>今天要做的事</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="thoughtDrift" value="沒有飄走">
                                    <span>沒有飄走</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="thoughtDrift" value="other">
                                    <span>其他</span>
                                    <div class="other-option">
                                        <input type="text" name="thoughtDriftOther" placeholder="請填寫">
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="question">
                            <h4>這三分鐘和您平常休息的方式相比，有什麼不同？</h4>
                            <div class="options">
                                <label class="option">
                                    <input type="checkbox" name="restComparison" value="更能覺察當下">
                                    <span>我更能覺察當下的身心狀態</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="restComparison" value="我感覺這次更放鬆">
                                    <span>我感覺這次更放鬆</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="restComparison" value="依賴手機">
                                    <span>平常的休息方式比較依賴手機或外部刺激</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="restComparison" value="沒有差別">
                                    <span>沒有太大差別</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="restComparison" value="other">
                                    <span>其他</span>
                                    <div class="other-option">
                                        <input type="text" name="restComparisonOther" placeholder="請填寫">
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="question">
                            <h4>您覺得自己能每天持續練習三分鐘正念嗎？如果不能，有什麼阻礙？</h4>
                            <div class="options">
                                <label class="option">
                                    <input type="checkbox" name="practiceObstacle" value="可以！我會試試看">
                                    <span>可以！我會試試看</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="practiceObstacle" value="沒時間">
                                    <span>沒時間</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="practiceObstacle" value="容易忘記">
                                    <span>容易忘記</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="practiceObstacle" value="環境太吵">
                                    <span>環境太吵</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="practiceObstacle" value="缺乏動力">
                                    <span>缺乏動力</span>
                                </label>
                                <label class="option">
                                    <input type="checkbox" name="practiceObstacle" value="other">
                                    <span>其他</span>
                                    <div class="other-option">
                                        <input type="text" name="practiceObstacleOther" placeholder="請填寫">
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="submit" class="btn-primary">完成反思</button>
                </div>
            </form>
        </section>
    </main>

    <script>
        document.getElementById('reflectionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                // 驗證使用時間
                const screenTimeValue = document.getElementById('screen-time').value;
                if (!screenTimeValue || screenTimeValue < 0 || screenTimeValue > 24) {
                    alert('請輸入有效的使用時間（0-24小時）');
                    return;
                }

                // 驗證必填欄位
                const screenTimeCompare = document.querySelector('input[name="screenTimeCompare"]:checked')?.value;
                const socialPhone = document.querySelector('input[name="socialPhone"]:checked')?.value;

                if (!screenTimeCompare) {
                    alert('請選擇使用時間是否比預期多或少');
                    return;
                }

                if (!socialPhone) {
                    alert('請選擇社交時是否會查看手機');
                    return;
                }

                // 收集表單資料
                const formData = {
                    screenTime: screenTimeValue,
                    screenTimeCompare: screenTimeCompare,
                    
                    // 休息活動（多選）
                    restActivity: Array.from(document.querySelectorAll('input[name="restActivity"]:checked'))
                        .map(input => input.value)
                        .filter(value => value !== 'other'),
                    restActivityOther: document.querySelector('input[name="restActivityOther"]')?.value || '',
                    
                    // 通勤活動（多選）
                    commutingActivity: Array.from(document.querySelectorAll('input[name="commutingActivity"]:checked'))
                        .map(input => input.value)
                        .filter(value => value !== 'other'),
                    commutingActivityOther: document.querySelector('input[name="commutingActivityOther"]')?.value || '',
                    
                    // 社交時查看手機
                    socialPhone: socialPhone,
                    socialPhoneOther: document.querySelector('input[name="socialPhoneOther"]')?.value || '',
                    
                    // 冥想體驗（多選）
                    meditationExperience: Array.from(document.querySelectorAll('input[name="meditationExperience"]:checked'))
                        .map(input => input.value)
                        .filter(value => value !== 'other'),
                    meditationExperienceOther: document.querySelector('input[name="meditationExperienceOther"]')?.value || '',
                    
                    // 思緒飄走（多選）
                    thoughtDrift: Array.from(document.querySelectorAll('input[name="thoughtDrift"]:checked'))
                        .map(input => input.value)
                        .filter(value => value !== 'other'),
                    thoughtDriftOther: document.querySelector('input[name="thoughtDriftOther"]')?.value || '',
                    
                    // 休息方式比較（多選）
                    restComparison: Array.from(document.querySelectorAll('input[name="restComparison"]:checked'))
                        .map(input => input.value)
                        .filter(value => value !== 'other'),
                    restComparisonOther: document.querySelector('input[name="restComparisonOther"]')?.value || '',
                    
                    // 持續練習意願與阻礙（多選）
                    practiceObstacle: Array.from(document.querySelectorAll('input[name="practiceObstacle"]:checked'))
                        .map(input => input.value)
                        .filter(value => value !== 'other'),
                    practiceObstacleOther: document.querySelector('input[name="practiceObstacleOther"]')?.value || '',
                    
                    // 加入時間戳記
                    timestamp: new Date().toISOString()
                };

                // 顯示載入中訊息
                const submitButton = document.querySelector('button[type="submit"]');
                const originalText = submitButton.textContent;
                submitButton.disabled = true;
                submitButton.textContent = '提交中...';

                // Google Apps Script Web App URL
                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz6vCRKRvY9EYbh8ZKz5fa7x-dBR_G2rfl4wBib0k_LpvbKsT8bziAwCzsX85ntlBwMFA/exec';
                
                console.log('準備發送的資料：', formData); // 記錄發送的資料

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                console.log('收到回應：', response); // 記錄回應狀態

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('回應內容：', result); // 記錄回應內容
                
                if (result.result === 'success') {
                    alert('感謝您的反思！');
                    window.location.href = 'thank-you.html';
                } else {
                    throw new Error(result.message || '提交失敗');
                }
            } catch (error) {
                console.error('提交表單時發生錯誤：', error);
                alert('抱歉，提交表單時發生錯誤，請稍後再試。\n錯誤訊息：' + error.message);
            } finally {
                // 恢復提交按鈕
                const submitButton = document.querySelector('button[type="submit"]');
                submitButton.disabled = false;
                submitButton.textContent = '完成反思';
            }
        });
    </script>
</body>
</html> 